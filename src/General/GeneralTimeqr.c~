#include "GeneralTimer.h"

/* タイマ初期化*/
void timer_init(void){
	ITU0.TSR.BIT.IMFA = 0;   //IMFAフラグをリセット
	ITU.TSTR.BIT.STR0 = 0x00;//カウンタ動作停止
	ITU0.TCR.BYTE = 0x23;    //GRAコンペアマッチ/インプットキャプチャでTCNTクリア、立ち上がりでカウント、8分周
	ITU0.GRA = 2;            //0.5[ns] * 2 = 1[us]
}

/* 1usタイマ */
void timer_us(int sec){
	int i;
	for(i=0; i<=sec; i++){
		ITU.TSTR.BIT.STR0 = 1;
		while(ITU0.TSR.BIT.IMFA == 0);
		ITU0.TSR.BIT.IMFA = 0;
		ITU.TSTR.BIT.STR0 = 0;
	}
}

/* 1msタイマ */
void timer_ms(int sec){
	int i;
	for(i=0; i<=sec; i++)
		timer_us(1000);
}
